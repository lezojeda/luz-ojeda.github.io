---
import type { CollectionEntry } from "astro:content";
import sortByDate from "../utils/dates";
import FormattedDate from "./FormattedDate.astro";

interface Props {
    posts: CollectionEntry<"microblog">[];
}

const { posts } = Astro.props;

const orderedPosts = posts.sort(sortByDate);
---

<ul class="no-style-list">
    {
        orderedPosts.map(async micropost => {
            const { Content } = await micropost.render();
            return (
                <li>
                    <div class="micropost-header">
                        <div class="title-section">
                            {micropost.data?.title && (
                                <h3 class="post-title">{micropost.data.title}</h3>
                            )}
                        </div>
                        <span class="date">
                            <FormattedDate pubDate={micropost.data?.pubDate} includeYearInDate />
                        </span>
                    </div>
                    <Content />
                    <hr />
                </li>
            );
        })
    }
</ul>

<style>
    .micropost-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .title-section {
        flex: 1;
    }
    
    .date {
        flex-shrink: 0;
        margin-left: auto;
    }
</style>
