<!DOCTYPE html>
<html lang="es">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <meta name="description" content="The personal web page of Luz Ojeda, a web developer and biologist from Buenos Aires, Argentina">
    <title>
      Luz Ojeda
      
        
        &#32-&#32 Un ejemplo del principio de segregación de interfaz
        
      
    </title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="icon" type="image/svg" href="/assets/svg/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  </head>
  <body>
    <aside id="sidebar-desktop" class="sidebar">
      <header>
  <div
  class="site-title">
  Luz Ojeda </a>
</header>

<nav id="sidebar-nav-links">
     





    <div class="page-links-group flex">
        
        <a
            class=" text section-link"
            href=" /es "
        >
            <span class="emoji">📔</span>&nbsp;blog
        </a>
        
    
        
         
         
        
        <a class=" text section-link" href="/es/microblog/">
            <span class="emoji">📝</span>
            microblog
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/leyendo/">
            <span class="emoji">📖</span>
            leyendo
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/fotos/">
            <span class="emoji">📷</span>
            fotos
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/megusta/">
            <span class="emoji">💜</span>
            me gusta
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/ahora/">
            <span class="emoji">🕒</span>
            ahora
        </a>
         
         
        
    </div>



    <div class="page-links-group flex">
        
    
        
         
         
        
        <a class=" text section-link" href="/es/proyectos/">
            <span class="emoji">👨‍💻</span>
            proyectos
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/cv/">
            <span class="emoji">📑</span>
            cv
        </a>
         
         
        
    </div>



    <div class="page-links-group flex">
        
    
        
         
         
        
        <a class=" text section-link" href="/es/sobre-mi/">
            <span class="emoji">🔍</span>
            sobre mí
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/contacto/">
            <span class="emoji">✉️</span>
            contacto y links
        </a>
         
         
        
    </div>



</nav>
 

<!-- Language switcher -->

  <a href="/">english</a>
 


  <strong><a href="/es/">español</a></strong>


    </aside>
    <aside id="sidebar-mobile" class="sidebar">
      <header>
  <div
  class="site-title">
  Luz Ojeda </a>
</header>

<nav id="sidebar-nav-links">
     





    <div class="page-links-group flex">
        
        <a
            class=" text section-link"
            href=" /es "
        >
            <span class="emoji">📔</span>&nbsp;blog
        </a>
        
    
        
         
         
        
        <a class=" text section-link" href="/es/microblog/">
            <span class="emoji">📝</span>
            microblog
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/leyendo/">
            <span class="emoji">📖</span>
            leyendo
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/fotos/">
            <span class="emoji">📷</span>
            fotos
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/megusta/">
            <span class="emoji">💜</span>
            me gusta
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/ahora/">
            <span class="emoji">🕒</span>
            ahora
        </a>
         
         
        
    </div>



    <div class="page-links-group flex">
        
    
        
         
         
        
        <a class=" text section-link" href="/es/proyectos/">
            <span class="emoji">👨‍💻</span>
            proyectos
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/cv/">
            <span class="emoji">📑</span>
            cv
        </a>
         
         
        
    </div>



    <div class="page-links-group flex">
        
    
        
         
         
        
        <a class=" text section-link" href="/es/sobre-mi/">
            <span class="emoji">🔍</span>
            sobre mí
        </a>
         
         
         
         
        
        <a class=" text section-link" href="/es/contacto/">
            <span class="emoji">✉️</span>
            contacto y links
        </a>
         
         
        
    </div>



</nav>
 

<!-- Language switcher -->

  <a href="/">english</a>
 


  <strong><a href="/es/">español</a></strong>


    </aside>
    <main><header class="post-header">
    <h1>Un ejemplo del principio de segregación de interfaz</h1>
</header>
<div><p>El principio de segregación de interfaces de <a href="https://en.wikipedia.org/wiki/SOLID">SOLID</a> establece que “no se debe obligar a los clientes a depender de interfaces que no utilizan”.</p>

<p>Trabajando en <a href="https://github.com/luz-ojeda/c-players-guide-endgame">Endgame</a>, el proyecto final del libro C# Player’s Guide, aproveché una oportunidad de aplicarlo. El proyecto es una aplicación de consola de juegos de rol con personajes. Cada uno en un grupo (héroes o monstruos).</p>

<p>Al principio tenía una única interfaz <code class="language-plaintext highlighter-rouge">ICharacter</code> que se veía más o menos así:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">ICharacter</span>
<span class="p">{</span>
	<span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
	<span class="kt">string</span> <span class="n">AttackName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Task</span> <span class="nf">Act</span><span class="p">(</span><span class="n">IAction</span> <span class="n">action</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Una implementación de esta interfaz fue el personaje del jugador, antes de implementar la acción de ataque adecuada:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">TrueProgrammer</span> <span class="p">:</span> <span class="n">ICharacter</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">"TOG"</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">string</span> <span class="n">AttackName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">"PUNCH"</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">float</span> <span class="n">MaxHP</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">25</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">float</span> <span class="n">HP</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

	<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Act</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">await</span> <span class="n">Statics</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span><span class="s"> did NOTHING."</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>También creé otros personajes como el jefe final y esqueletos:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Skeleton</span> <span class="p">:</span> <span class="n">ICharacter</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">"Skeleton"</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">string</span> <span class="n">AttackName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">"BONE CRUNCH"</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">float</span> <span class="n">MaxHP</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
	<span class="k">public</span> <span class="kt">float</span> <span class="n">HP</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

	<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Act</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">await</span> <span class="n">Statics</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span><span class="s"> did NOTHING."</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Las otras clases relacionadas para ejecutar el juego son <code class="language-plaintext highlighter-rouge">Battle</code>, <code class="language-plaintext highlighter-rouge">Party</code> y <code class="language-plaintext highlighter-rouge">AttackAction</code>.</p>

<p><code class="language-plaintext highlighter-rouge">Battle</code> representa cada batalla en el juego con las partes asociadas jugando el turno de cada parte alternativamente. Cuando el usuario o la computadora eligen atacar a un objetivo de la otra parte, se ejecuta el método <code class="language-plaintext highlighter-rouge">Ejecutar</code> de <code class="language-plaintext highlighter-rouge">AttackAction</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Run</span><span class="p">(</span><span class="n">ICharacter</span> <span class="n">character</span><span class="p">,</span> <span class="n">Battle</span> <span class="n">battle</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">float</span> <span class="n">damage</span> <span class="p">=</span> <span class="n">character</span><span class="p">.</span><span class="n">Attack</span><span class="p">.</span><span class="n">Damage</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">_target</span><span class="p">.</span><span class="n">HP</span> <span class="p">-</span> <span class="n">damage</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">_target</span><span class="p">.</span><span class="n">HP</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
			<span class="nf">RemoveCharacterFromParty</span><span class="p">(</span><span class="n">_target</span><span class="p">,</span> <span class="n">battle</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="c1">// reducir putnos de vida</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">private</span> <span class="k">void</span> <span class="nf">RemoveCharacterFromParty</span><span class="p">(</span><span class="n">ICharacter</span> <span class="n">character</span><span class="p">,</span> <span class="n">Battle</span> <span class="n">battle</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">character</span><span class="p">.</span><span class="n">PartyType</span> <span class="p">==</span> <span class="n">PartyType</span><span class="p">.</span><span class="n">Monsters</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">battle</span><span class="p">.</span><span class="n">Monsters</span><span class="p">.</span><span class="n">Characters</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">character</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">battle</span><span class="p">.</span><span class="n">Heroes</span><span class="p">.</span><span class="n">Characters</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">character</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
</code></pre></div></div>

<p>Esto empezó a hacerme ruido ya que tenía que pasar toda la instancia de <code class="language-plaintext highlighter-rouge">Battle</code> a cada acción <em>solo</em> para eliminar al personaje del grupo (ir “subiendo” a la batalla, luego bajando al grupo del personaje).</p>

<p>Mi primera idea fue crear un método <code class="language-plaintext highlighter-rouge">Die()</code> que emitiera un <code class="language-plaintext highlighter-rouge">evento</code>. Luego, las partes se suscribirían y eliminarían los personajes que emitieron el evento.</p>

<p>Pero haciendo esto:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">ICharacter</span>
<span class="p">{</span>
	<span class="p">...</span>
    <span class="k">void</span> <span class="nf">Die</span><span class="p">();</span>
    <span class="k">event</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ICharacterCore</span><span class="p">&gt;?</span> <span class="n">CharacterDied</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Me llevaría a implementar el mismo código para cada personaje que murió. <code class="language-plaintext highlighter-rouge">Skeleton</code> debería tener una implementación de <code class="language-plaintext highlighter-rouge">Die()</code> así como cualquier otra de las decenas de caracteres que pudiera agregar más adelante.</p>

<p>Entonces, con respecto al título del post, creé otra interfaz:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">ICharacterCore</span>
<span class="p">{</span>
	<span class="k">void</span> <span class="nf">Die</span><span class="p">();</span>
	<span class="k">event</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ICharacterCore</span><span class="p">&gt;?</span> <span class="n">CharacterDied</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Una que implemente ambas:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IPartyCharacter</span> <span class="p">:</span> <span class="n">ICharacter</span><span class="p">,</span> <span class="n">ICharacterCore</span><span class="p">;</span>
</code></pre></div></div>

<p>…una clase base que implemente <code class="language-plaintext highlighter-rouge">ICharacterCore</code> y el método <code class="language-plaintext highlighter-rouge">Die()</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Character</span> <span class="p">:</span> <span class="n">ICharacterCore</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="k">event</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">ICharacterCore</span><span class="p">&gt;?</span> <span class="n">CharacterDied</span><span class="p">;</span>

	<span class="k">public</span> <span class="k">void</span> <span class="nf">Die</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">CharacterDied</span><span class="p">?.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Y finalmente actualicé las clases de personajes para que hereden <code class="language-plaintext highlighter-rouge">Character</code>, implementen <code class="language-plaintext highlighter-rouge">IPartyCharacter</code> y así heredar el método <code class="language-plaintext highlighter-rouge">Die()</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">TrueProgrammer</span> <span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">IPartyCharacter</span>
<span class="p">{</span>
	<span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Esto llevó a un método <code class="language-plaintext highlighter-rouge">Run</code> simplificado y también a un enfoque más intuitivo. Considerando que es mejor que la instancia <code class="language-plaintext highlighter-rouge">Party</code> sea responsable de eliminar caracteres, no una acción.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Run</span><span class="p">(</span><span class="n">ICharacter</span> <span class="n">character</span><span class="p">,</span> <span class="n">Battle</span> <span class="n">battle</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">float</span> <span class="n">damage</span> <span class="p">=</span> <span class="n">character</span><span class="p">.</span><span class="n">Attack</span><span class="p">.</span><span class="n">Damage</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">_target</span><span class="p">.</span><span class="n">HP</span> <span class="p">-</span> <span class="n">damage</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">_target</span><span class="p">.</span><span class="n">HP</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
			<span class="n">_target</span><span class="p">.</span><span class="nf">Die</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="c1">// reducir puntos de vida</span>
			<span class="p">...</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// No es necesario el método RemoveCharacterFromParty()</span>
</code></pre></div></div>

<p>El uso de dos interfaces (<code class="language-plaintext highlighter-rouge">ICharacterCore</code> y <code class="language-plaintext highlighter-rouge">ICharacter</code>) en lugar de solo una (<code class="language-plaintext highlighter-rouge">ICharacter</code>) me permitió implementar la función de eliminación de Parties y el método <code class="language-plaintext highlighter-rouge">Die</code> desde un solo lugar en lugar de varios. Puede haber otros enfoques para evitar la repetición de la implementación <code class="language-plaintext highlighter-rouge">Die()</code> además de varias interfaces, pero estoy satisfecho con este.</p>

<p>Además, quizás notaste que ambos personajes tenían la misma implementación <code class="language-plaintext highlighter-rouge">Act()</code>. Ese método se modificó posteriormente y también se trasladó a cada clase de ataque diferente.</p>

<p>Lo siguiente no está relacionado con el principio de segregación de la interfaz, pero si amplía sobre cómo terminé de implementar <code class="language-plaintext highlighter-rouge">Party</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Party</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="n">PartyType</span> <span class="n">Type</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IPartyCharacter</span><span class="p">&gt;</span> <span class="n">Characters</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="p">[];</span>
	<span class="k">public</span> <span class="n">PlayerType</span> <span class="n">PlayerInControl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IPartyItem</span><span class="p">&gt;</span> <span class="n">Items</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="p">[];</span>
	<span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IPartyGear</span><span class="p">&gt;</span> <span class="n">Gear</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="p">[];</span>

	<span class="k">public</span> <span class="nf">Party</span><span class="p">(</span><span class="n">PartyType</span> <span class="n">type</span><span class="p">,</span> <span class="n">PlayerType</span> <span class="n">playerInControl</span> <span class="p">=</span> <span class="n">PlayerType</span><span class="p">.</span><span class="n">Computer</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">// Inicialización y asignación de elementos según el tipo de parte</span>
        <span class="p">...</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">characterCore</span> <span class="k">is</span> <span class="n">IPartyCharacter</span> <span class="n">character</span> <span class="p">&amp;&amp;</span> <span class="n">Characters</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">character</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="n">Characters</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">character</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// Otros métodos</span>
	<span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>
</div>
</main>
    <footer>
      <button id="hamburger-menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <title>Open sidebar</title>
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10"
        stroke-width="32" d="M80 160h352M80 256h352M80 352h352" />
</svg></button>
    </footer>
    <script src="/es/scripts/toggleSidebarVisibility.js"></script>
  </body>
</html>
